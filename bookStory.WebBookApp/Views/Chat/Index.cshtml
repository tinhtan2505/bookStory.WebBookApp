@*@using bookStory.ViewModels.Common;
@model PagedResult<bookStory.ViewModels.Catalog.Chats.ChatViewModel>*@
@model ChatDetailViewModel

@{
    ViewData["Title"] = "Chat";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section Scripts{
    <script src="~/js/signalrchat.js"></script>
    <script>
        setTimeout(function () {
            $('#msgAlert').fadeOut('slow');
        }, 2000);
    </script>
    <script>
      $(".ratingStar").click(function () {
        debugger;
        var starValue = $(this).attr("data-value");
        $("#ratingValue").val(starValue);
      });
    </script>
}
<div class="container">
    <div class="row">
        <div class="col-md-12 text-center">
            <div class="text-pageheader">
                <div class="subtext-image"
                     data-scrollreveal="enter bottom over 1.7s after 0.1s">
                    BẢN DỊCH
                </div>
            </div>
        </div>
    </div>
</div>
    </div>
    </header>

<!-- CONTENT =============================-->
<section class="item content">
    <div class="container toparea">
        <div class="underlined-title">
            <div class="editContent">
                <h1 class="text-center latestitems">Danh sách bản dịch</h1>
            </div>
            <div class="wow-hr type_short">
                <span class="wow-hr-h">
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                </span>
            </div>
        </div>
        <input type="hidden" value="@User.Identity.Name" class="form-control" id="unsender" name="unsender" />
     <div class="home-page__content messages-page">
            <div class="container-fluid h-100">
                <div class="row px-0 h-100" id="tongchihuy">
                <div class="col-12 col-md-4 messages-page__list-scroll">

                    <div class="messages-page__header mb-0 px-4 pt-3 pb-3">
                    <span class="messages-page__title">Chats</span>
                    <div class="messages-page__dark-mode-toogler">
                        <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon svg-icon--dark-mode" viewBox="0 0 49.7 49.7">
                        <path d="M25.4,49.7A25.6,25.6,0,0,1,1.3,32.3,25.6,25.6,0,0,1,17.3.1a2,2,0,0,1,2.1.5,2.2,2.2,0,0,1,.5,2.1,19.9,19.9,0,0,0-1.2,6.8A21,21,0,0,0,25,24.7,21,21,0,0,0,40.2,31h0a20.9,20.9,0,0,0,6.9-1.2,2,2,0,0,1,2.5,2.5,25.8,25.8,0,0,1-16,16.1A28.7,28.7,0,0,1,25.4,49.7ZM15,5.5A21.4,21.4,0,0,0,5.1,31.1,21.5,21.5,0,0,0,15.9,43.4a21.2,21.2,0,0,0,28.3-8.8,17.5,17.5,0,0,1-4,.4h0a24.9,24.9,0,0,1-18-7.5,24.9,24.9,0,0,1-7.5-18A26.9,26.9,0,0,1,15,5.5Z" fill="#f68b3c" />
                        </svg>
                    </div>
                    </div>
                    <div class="messages-page__search mb-0 px-3 pb-3">
                    <div class="custom-form__search-wrapper">
                        <input type="text" class="form-control custom-form" id="search" placeholder="Rechercher un message, un utilisateur…" autocomplete="off">
                        <button type="submit" class="custom-form__search-submit">
                        <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon svg-icon--search" viewBox="0 0 46.6 46.6">
                            <path d="M46.1,43.2l-9-8.9a20.9,20.9,0,1,0-2.8,2.8l8.9,9a1.9,1.9,0,0,0,1.4.5,2,2,0,0,0,1.5-.5A2.3,2.3,0,0,0,46.1,43.2ZM4,21a17,17,0,1,1,33.9,0A17.1,17.1,0,0,1,33,32.9h-.1A17,17,0,0,1,4,21Z" fill="#f68b3c" />
                        </svg>
                        </button>
                    </div>
                    </div>
                    @*danh sách tin nhắn*@
                    <ul class="messages-page__list pb-5 px-1 px-md-3">
                            @{
                                string[] list_un2 = new string[1000];
                                int dem = 0;
                                string un2first = "";
                            }
                            @foreach (var chat in Model.ListChats)
                            {
                                var mce = "listchat"+@chat.Id.ToString();
                                if(chat.UserName1 == User.Identity.Name)
                                {
                                    bool kt = false;
                                for (int i=0; i<dem; i++)
                                {
                                    if (chat.UserName2 == list_un2[i])
                                    {
                                        kt = true;
                                        break;
                                    }
                                }
                                if (kt == false)
                                {
                                    list_un2[dem] = chat.UserName2;
                                    dem++;
                                    if(dem == 1)
                                    {
                                       
                                       <li  class="messaging-member messaging-member--active" data-toggle="collapse" data-target="#@mce" aria-expanded="true" aria-controls=@mce>
                                           <div class="messaging-member__wrapper">
                                                <div class="messaging-member__avatar">
                                                    <img src="https://randomuser.me/api/portraits/thumb/women/17.jpg" alt="Courtney Simmons" loading="lazy">
                                                    <div class="user-status"></div>
                                                </div>

                                                <span class="messaging-member__name">@chat.FirstName2 @chat.LastName2</span>
                                                <span class="messaging-member__message">@chat.Message</span>
                                            </div>
                                        </li>
                                    }
                                    else
                                    {
                                        <li  class="messaging-member" >
                                           <div class="messaging-member__wrapper" data-toggle="collapse" data-toggle="collapse" data-target="#@mce" aria-expanded="true" aria-controls=@mce>
                                                <div class="messaging-member__avatar">
                                                    <img src="https://randomuser.me/api/portraits/thumb/women/17.jpg" alt="Courtney Simmons" loading="lazy">
                                                    <div class="user-status"></div>
                                                </div>

                                                <span class="messaging-member__name">@chat.FirstName2 @chat.LastName2</span>
                                                <span class="messaging-member__message">@chat.Message</span>
                                            </div>
                                        </li>
                                    }
                                }
                                }
                                
                            }
                        @*<div id="listReceiver"></div>*@
                    </ul>
                </div>

                <div class="chat col-12 col-md-8" id="chatsender">
                 
                </div>
                
                </div>
            </div>
            </div>
            
            @*=====================================================================================================*@
            
                @*=////////////////////////////////////////////////=*@
    </div>
</section>